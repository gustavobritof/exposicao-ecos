<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Museu Espacial VR</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.6.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-orbit-controls@1.3.2/dist/aframe-orbit-controls.min.js"></script>
    <script src="sceneManager.js"></script>
    <link rel="stylesheet" href="screenloader.css">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            transition: opacity 0.8s ease-in-out;
            opacity: 0;
            background-color: black;
        }


        #cena-titulo {
            position: fixed;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            color: #e6f0ff;
            font-family: 'Inter', sans-serif;
            font-size: clamp(1rem, 4vw, 1.5rem);
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin: 0;
            pointer-events: none;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
            text-align: center;
            padding: 0 20px;
        }


        button {
            position: fixed;
            top: 20px;
            left: 15px;
            z-index: 9999;
            padding: 0.8rem 1.5rem;
            font-size: 0.75rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            background: transparent;
            color: #e6f0ff;
            border: 1px solid rgba(230, 240, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-family: 'Inter', sans-serif;
            white-space: nowrap;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            /* Melhora resposta ao toque */
        }

        button:hover,
        button:active {
            background: rgba(30, 45, 70, 0.95);
            border-color: rgba(230, 240, 255, 0.6);
            transform: scale(1.05);
        }

        /* RESPONSIVO MOBILE */
        @media (max-width: 768px) {
            #cena-titulo {
                font-size: 0.9rem;
                top: 10px;
                letter-spacing: 0.1em;
            }

            button {
                top: 15px;
                left: 10px;
                padding: 0.7rem 1.2rem;
                font-size: 0.7rem;
                letter-spacing: 0.1em;
            }
        }

        @media (max-width: 480px) {
            #cena-titulo {
                font-size: 0.75rem;
                max-width: 90%;
            }

            button {
                top: 45px;
                left: 8px;
                padding: 0.6rem 1rem;
                font-size: 0.65rem;
            }
        }
    </style>

    <script>
        // Recupera qual modelo deve ser exibido
        const modeloExibicao = sessionStorage.getItem('modeloExibicao');

        // Define qual modelo renderizar
        let modeloAtual = modeloExibicao || 'hubble'; // Padrão: hubble
    </script>
</head>

<body>
    <h1 id="cena-titulo">Cena 2</h1>
    <button>Voltar para sala</button>

    <div id="custom-loader">
        <div class="stars"></div>

        <div class="orbit-container">
            <div class="orbit orbit-1"></div>
            <div class="orbit orbit-2"></div>
            <div class="orbit orbit-3"></div>
            <div class="planet"></div>
            <div class="satellite"></div>
        </div>

        <div class="loader-text">CARREGANDO</div>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="progress-text" id="progress-text">0%</div>
    </div>

    <a-scene id="scene03">
        <a-assets>
            <a-asset-item id="hubble" src="models/hubble.glb"></a-asset-item>
            <a-asset-item id="voyager" src="models/Voyager 1.glb"></a-asset-item>
            <a-asset-item id="jwst" src="models/jwst_james_webb_space_telescope.glb"></a-asset-item>
            <a-asset-item id="saturnv" src="models/saturnV.glb"></a-asset-item>
            <a-asset-item id="iss" src="models/ISS_Correct.glb"></a-asset-item>
        </a-assets>

        <!-- <a-entity look-controls="enabled:false" camera orbit-controls="
          target: 0 4 0;
          minDistance: 4; 
          maxDistance: 180;
          rotateSpeed: 0.6;
          initialPosition: 6 8 8;
          rotationSpeed: 0.5;
        "> </a-entity> -->


        <!-- CÂMERA ORBIT (PC + MOBILE) -->
        <a-entity id="orbit-camera" camera orbit-controls="
    target: 0 4 0;
    initialPosition: 6 8 8;
    minDistance: 4;
    maxDistance: 180;
    rotateSpeed: 0.6;
    autoRotateSpeed: 0.5;
  ">
        </a-entity>

        <!-- CÂMERA VR (CARDBOARD)
        <a-entity id="vr-camera" visible="false">
            <a-camera look-controls wasd-controls="enabled:false">
                <a-cursor fuse="true" fuse-timeout="1200"></a-cursor>
            </a-camera>
        </a-entity> -->

        <!-- Iluminação Visualizador -->
        <a-light type="ambient" intensity="0.5" color="#ffffff"></a-light>
        <a-light type="directional" intensity="0.8" position="5 5 5" color="#ffffff"></a-light>
        <a-light type="point" intensity="3" position="0 6 0" color="#ffffff"></a-light>
        <a-light type="point" intensity="0.6" position="-5 3 -5" color="#e0f0ff"></a-light>
        <a-light type="point" intensity="0.6" position="5 3 -5" color="#e0f0ff"></a-light>
        <a-light type="point" intensity="0.6" position="0 3 5" color="#e0f0ff"></a-light>

        <!-- Fundo Gradiente (Sky) -->
        <a-sky color="#1a1a2e"></a-sky>
        <!-- Piso Reflexivo -->
        <!-- <a-plane rotation="-90 0.4 0" width="30" height="30" color="#16213e" roughness="0.3" metalness="0.5"
            shadow></a-plane> -->

        <!-- MODELO DINÂMICO (muda conforme clicado) -->
        <a-entity id="dynamic-model" position="0 4 0" scale="0.003 0.003 0.003"></a-entity>


        <a-entity grid-linhas="tamanho: 100; divisoes: 40; cor: #5ac8fa; opacidade: 0.2"></a-entity>


    </a-scene>



</body>


<script>
    AFRAME.registerComponent('grid-linhas', {
        schema: {
            tamanho: { type: 'number', default: 50 },
            divisoes: { type: 'number', default: 50 },
            cor: { type: 'color', default: '#4444ff' }
        },
        init: function () {
            // Cria o GridHelper do Three.js (que são apenas linhas)
            this.grid = new THREE.GridHelper(
                this.data.tamanho,
                this.data.divisoes,
                this.data.cor, // Cor da linha central
                this.data.cor  // Cor das outras linhas
            );

            // Garante que o material seja visível de ambos os lados (opcional para linhas, mas bom garantir)
            this.grid.material.side = THREE.DoubleSide;
            this.grid.material.transparent = true;
            this.grid.material.opacity = 0.5; // Ajuste a opacidade conforme desejar

            this.el.setObject3D('mesh', this.grid);
        }
    });

    // Carrega o modelo dinamicamente
    window.addEventListener('load', function () {
        const modeloExibicao = sessionStorage.getItem('modeloExibicao') || 'hubble';

        // Adiciona evento de clique no botão voltar
        const btnVoltar = document.querySelector('button');
        btnVoltar.addEventListener('click', function () {
            document.body.style.opacity = '0';
            setTimeout(() => {
                window.location.href = 'scene02.html'; // Ajuste para sua cena anterior
            }, 500);
        });

        // Carrega configurações do JSON
        fetch('modelsConfig.json')
            .then(r => r.json())
            .then(modelsConfig => {
                const config = modelsConfig[modeloExibicao]?.scene03 || {
                    position: '0 4 0',
                    scale: '0.003 0.003 0.003',
                    rotation: '0 0 0'
                };

                const dynamicModel = document.getElementById('dynamic-model');

                // Mapeamento dos modelos
                const modelMap = {
                    'hubble': 'hubble',
                    'voyager': 'voyager',
                    'jwst': 'jwst',
                    'saturnv': 'saturnv',
                    'iss': 'iss'
                };

                const assetId = modelMap[modeloExibicao];
                if (assetId) {
                    dynamicModel.setAttribute('gltf-model', `#${assetId}`);
                    dynamicModel.setAttribute('position', config.position);
                    dynamicModel.setAttribute('scale', config.scale);
                    dynamicModel.setAttribute('rotation', config.rotation);
                }

                // Atualiza o título
                const titles = {
                    'hubble': 'TELESCÓPIO HUBBLE',
                    'voyager': 'SONDA VOYAGER 1',
                    'jwst': 'JAMES WEBB SPACE TELESCOPE',
                    'saturnv': 'FOGUETE SATURN V',
                    'iss': 'ESTAÇÃO ESPACIAL INTERNACIONAL'
                };

                document.getElementById('cena-titulo').textContent = titles[modeloExibicao] || 'MODELO 3D';
            })
            .catch(err => {
                console.error('Erro ao carregar modelsConfig.json:', err);
            });
    });
</script>

</html>