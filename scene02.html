<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Museu Espacial VR</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="sceneManager.js"></script>
    <link rel="stylesheet" href="screenloader.css">
    <script src="https://cdn.rawgit.com/mrturck/aframe-joystick/master/joystick.min.js"></script>
    <!-- Componente para texto curvo -->
    <script>
        // Componente de transição com singularidade
        AFRAME.registerComponent('wormhole-transition', {
            schema: {
                active: { type: 'boolean', default: false },
                duration: { type: 'number', default: 2500 }
            },
            init: function () {
                this.tunnel = this.el;
                this.camera = document.querySelector('a-camera');
                this.startTime = 0;
                this.transitioning = false;
            },
            update: function (oldData) {
                if (this.data.active && !oldData.active) {
                    this.startTransition();
                }
            },
            startTransition: function () {
                this.transitioning = true;
                this.startTime = Date.now();

                const cameraPos = this.camera.object3D.position;
                const cameraRot = this.camera.object3D.rotation;

                const distance = 8;
                const tunnelX = cameraPos.x + Math.sin(cameraRot.y) * distance;
                const tunnelZ = cameraPos.z + Math.cos(cameraRot.y) * distance;

                this.tunnel.setAttribute('position', `${tunnelX} ${cameraPos.y} ${tunnelZ}`);
                this.tunnel.setAttribute('rotation', `0 ${cameraRot.y * 180 / Math.PI} 0`);
                this.tunnel.setAttribute('visible', true);
            },
            tick: function () {
                if (!this.transitioning) return;

                const elapsed = Date.now() - this.startTime;
                const progress = Math.min(elapsed / this.data.duration, 1);

                const scale = 0.5 + progress * 3;
                this.tunnel.setAttribute('scale', `${scale} ${scale} ${scale}`);

                const rotation = progress * 720;
                const currentRot = this.tunnel.getAttribute('rotation');
                this.tunnel.setAttribute('rotation', `0 ${currentRot.y} ${rotation}`);

                const cameraPos = this.camera.object3D.position;
                const tunnelPos = this.tunnel.object3D.position;
                const moveSpeed = progress * 0.3;

                cameraPos.x += (tunnelPos.x - cameraPos.x) * moveSpeed;
                cameraPos.z += (tunnelPos.z - cameraPos.z) * moveSpeed;

                if (progress >= 1) {
                    this.transitioning = false;
                }
            }
        });

        AFRAME.registerComponent('curved-text', {
            schema: {
                value: { type: 'string', default: '' },
                radius: { type: 'number', default: 5 },
                arc: { type: 'number', default: 30 },
                color: { type: 'color', default: '#000000' },
                fontSize: { type: 'number', default: 0.3 }
            },
            init: function () {
                const data = this.data;
                const text = data.value;
                const numChars = text.length;
                const angleStep = (data.arc * Math.PI / 180) / (numChars - 1 || 1);
                const startAngle = -(data.arc * Math.PI / 180) / 2;

                for (let i = 0; i < numChars; i++) {
                    const char = text[i];
                    if (char === ' ') continue;

                    const angle = startAngle + (i * angleStep);
                    const x = Math.sin(angle) * data.radius;
                    const z = -Math.cos(angle) * data.radius;
                    const rotationY = -angle * (180 / Math.PI);

                    const charEntity = document.createElement('a-text');
                    charEntity.setAttribute('value', char);
                    charEntity.setAttribute('position', `${x} 0 ${z}`);
                    charEntity.setAttribute('rotation', `0 ${rotationY} 0`);
                    charEntity.setAttribute('color', data.color);
                    charEntity.setAttribute('align', 'center');
                    charEntity.setAttribute('anchor', 'center');
                    charEntity.setAttribute('width', data.fontSize * 10);
                    charEntity.setAttribute('baseline', 'center');

                    this.el.appendChild(charEntity);
                }
            }
        });
    </script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            transition: opacity 0.8s ease-in-out;
            opacity: 0;
            background-color: black;
        }



        #dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        #dialog-content {
            background-color: #e8dcc7;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 20px rgba(139, 115, 85, 0.5);
        }

        #dialog-content h2 {
            color: #2c5f7f;
            margin-top: 0;
        }

        #dialog-content p {
            color: #2c3e50;
            line-height: 1.6;
        }

        #close-dialog {
            background-color: #8b7355;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }

        #close-dialog:hover {
            background-color: #2c5f7f;
        }
    </style>
</head>

<body>
    <div id="custom-loader">
        <div class="stars"></div>

        <div class="orbit-container">
            <div class="orbit orbit-1"></div>
            <div class="orbit orbit-2"></div>
            <div class="orbit orbit-3"></div>
            <div class="planet"></div>
            <div class="satellite"></div>
        </div>

        <div class="loader-text">CARREGANDO</div>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="progress-text" id="progress-text">0%</div>
    </div>
    <h1 id="cena-titulo">Cena 2</h1>

    <!-- Overlay para diálogos expansíveis -->
    <div id="dialog-overlay">
        <div id="dialog-content">
            <h2 id="dialog-title"></h2>
            <p id="dialog-text"></p>
            <button id="close-dialog">Fechar</button>
        </div>
    </div>

    <a-scene id="scene02" joystick>
        <a-assets>
            <img id="singularity-texture" src="/assets/singularity.jpg">
            <a-asset-item id="hubble-asset" src="models/hubble.glb"></a-asset-item>
            <a-asset-item id="voyager-asset" src="models/Voyager 1.glb"></a-asset-item>
            <a-asset-item id="jwst-asset" src="models/jwst_james_webb_space_telescope.glb"></a-asset-item>
            <a-asset-item id="saturnv-asset" src="models/saturnV.glb"></a-asset-item>
            <a-asset-item id="iss-asset" src="models/ISS_Correct.glb"></a-asset-item>


            <img src="images/ceu-noturno-estrelado-azul-e-branco.jpg" id="sky">
            <img id="hotspot-img" src="images/HotspotIcon.png">
            <img id="crossIcon" src="https://img.icons8.com/?size=100&id=43925&format=png&color=FFFFFF" alt="Fechar">
            <img id="360scene01" src="images/360scene01.png" alt="Cena1 360 Graus">
            <!-- Template do painel 3D -->
            <template id="infoPanel3D">



                <a-entity rotation="0 -90 0" position="0.96 0 -1.65">
                    <a-plane color="#1a1a1a" height="1.5" width="2.5" position="" material="" geometry="">
                        <a-text
                            value="VISUALIZADOR 3D\n\nVeja o modelo em detalhes com visualizacao 360 graus e controles completos."
                            align="center" width="2.2" position="0 0.2 0.01" text=""></a-text>
                        <a-image id="close-btn-3d" src="#crossIcon" class="clickable" position="1.1 0.6 0.001"
                            width="0.25" cursor-hover="" height="0.25" material="" geometry=""></a-image>
                        <a-box id="view-3d-btn" position="0 -0.5 0.05" width="1.8" height="0.3" depth="0.05"
                            class="clickable" color="#ff6600" material="emissive: #ff6600; emissiveIntensity: 0.5"
                            cursor-hover="" geometry="">
                            <a-text value="Ver em 3D" position="0 0 0.04" align="center" anchor="center" color="#ffffff"
                                font-size="16" text=""></a-text>
                        </a-box>
                    </a-plane>
                </a-entity>
            </template>
            <!-- Imagens mockup para os painéis -->
            <img src="images/background.jpg" id="panel-historia-img" crossorigin="anonymous">
            <img src="images/background.jpg" id="panel-tecnologia-img" crossorigin="anonymous">
            <img src="images/background.jpg" id="panel-missoes-img" crossorigin="anonymous">
            <img src="images/background.jpg" id="panel-futuro-img" crossorigin="anonymous">
        </a-assets>


        <a-camera position="0 1.6 0" cursor="rayOrigin: mouse" id="camera" raycaster="objects: .clickable; far: 20"
            look-controls="reverseMouseDrag: false; magicWindowTrackingEnabled: false" wasd-controls="enabled: true"
            mobile-look-controls wall-collision>

            <a-cursor color="#ffffff" fuse="false" fuse-timeout="2000"
                animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 2000; from: 1 1 1; to: 0.1 0.1 0.1"
                animation__mouseleave="property: scale; startEvents: mouseleave; easing: easeInCubic; dur: 200; to: 1 1 1"></a-cursor>
        </a-camera>

        <!-- Iluminação Galeria -->
        <a-light type="ambient" intensity="0.1" color="#ffffff"></a-light>
        <a-light type="directional" intensity="0.4" position="3 4 3" color="#ffffff"></a-light>
        <a-light type="point" intensity="0.4" position="-5 2.5 -3" color="#e0f0ff"></a-light>
        <!-- <a-light type="point" intensity="0.4" position="5 2.5 -3" color="#e0f0ff"></a-light> -->

        <!-- Ambiente Galeria (Sala Menor Semi-circular) -->
        <a-sky src="#sky" animation="property: rotation; to: 0 360 0; loop: true; dur: 240000; easing: linear"></a-sky>
        <!-- Chão circular -->
        <a-circle color="#8b6f47" radius="5" rotation="-90 0 0" position="0 0 -2" shadow></a-circle>
        <a-circle color="#a0826d" radius="3" rotation="-90 0 0" position="0 0.01 -2" shadow></a-circle>
        <!-- Teto -->
        <a-circle color="#e8dcc7" radius="5" rotation="90 0 0" position="0 3.2 -2"></a-circle>

        <!-- Parede de fundo curva (semi-círculo) -->
        <a-curvedimage src="" height="3.2" radius="5" theta-length="180" rotation="0 0 0" position="0 1.6 -2"
            material="color: #e8dcc7; side: double"></a-curvedimage>
        <a-curvedimage src="" height="1" width="5" radius="5" theta-length="180" theta-start="180" rotation="0 0 0"
            position="0 0.5 -2" material="color: #e8dcc7; side: double"></a-curvedimage>
        <!-- Cerca decorativa circular -->
        <!-- Anel horizontal da cerca -->
        <a-torus color="#8b7355" radius="3" radius-tubular="0.05" position="0 0.5 -2" rotation="90 0 0"
            emissive="#8b7355" emissive-intensity="0.3"></a-torus>

        <!-- Postes verticais da cerca (distribuídos ao redor) -->
        <a-cylinder color="#8b7355" radius="0.05" height="0.6" position="3 0.3 -2" emissive="#8b7355"
            emissive-intensity="0.2"></a-cylinder>
        <a-cylinder color="#8b7355" radius="0.05" height="0.6" position="2.12 0.3 -4.12" emissive="#8b7355"
            emissive-intensity="0.2"></a-cylinder>
        <a-cylinder color="#8b7355" radius="0.05" height="0.6" position="0 0.3 -5" emissive="#8b7355"
            emissive-intensity="0.2"></a-cylinder>
        <a-cylinder color="#8b7355" radius="0.05" height="0.6" position="-2.12 0.3 -4.12" emissive="#8b7355"
            emissive-intensity="0.2"></a-cylinder>
        <a-cylinder color="#8b7355" radius="0.05" height="0.6" position="-3 0.3 -2" emissive="#8b7355"
            emissive-intensity="0.2"></a-cylinder>
        <a-cylinder color="#8b7355" radius="0.05" height="0.6" position="-2.12 0.3 0.12" emissive="#8b7355"
            emissive-intensity="0.2"></a-cylinder>
        <a-cylinder color="#8b7355" radius="0.05" height="0.6" position="0 0.3 1" emissive="#8b7355"
            emissive-intensity="0.2"></a-cylinder>
        <a-cylinder color="#8b7355" radius="0.05" height="0.6" position="2.12 0.3 0.12" emissive="#8b7355"
            emissive-intensity="0.2"></a-cylinder>


        <!-- Moldura superior curva -->
        <a-torus color="#8b7355" radius="5" radius-tubular="0.08" position="0 3.1 -2" rotation="90 0 0"
            emissive="#8b7355" emissive-intensity="0.3"></a-torus>


        <!-- Pedestal no canto -->
        <a-cylinder color="#8b7355" radius="0.8" height="1" position="-4 0.5 -2" shadow></a-cylinder>
        <a-cylinder color="#8b7355" radius="0.85" height="0.15" position="-4 1.063 -2" shadow
            emissive="#8b7355"></a-cylinder>
        <!-- MODELO 3D DINÂMICO no canto -->
        <a-entity id="dynamic-model-pedestal" class="clickable" position="-4 1.474 -2" scale="0.004 0.004 0.004"
            rotation="0 45 0" cursor-hover
            animation="property: rotation; to: 0 405 0; loop: true; dur: 8000; easing: linear" cursor-hover>
        </a-entity>

        <!-- Hotspot para visualização 3D -->
        <a-entity id="hotspot-3d-container" position="-3.1 0.9 -1.93" rotation="0 90 0">
            <a-image id="hotspot-3d-icon" src="#hotspot-img" class="clickable" data-triggerable-button="3d" cursor-hover
                billboard scale="0.5 0.5 0.5" material="depthTest: false; shader: flat" look-at="[camera]"></a-image>
            <a-entity id="infoPanelContainer3D" position="0 0.5 0" rotation="0 120 0"></a-entity>
        </a-entity>

        <!-- Título Principal da Galeria com Placa Arredondada -->
        <a-entity position="4.24 2.91 -1.96" rotation="0 -90 0">
            <a-box color="#8b7355" width="4.5" height="0.45" depth="0.08" opacity="0.9" geometry=""
                material="side: double" curved-text="color: #ad0000" visible=""></a-box>
            <a-text id="gallery-main-title" align=" center" anchor="center" position="0 0 0.08" color="#ffffff"
                font-size="24" width="9" font-weight="bold" text="width: 6.45;"></a-text>
        </a-entity>

        <!-- Painéis Temáticos Curvos na Parede -->
        <!-- História (esquerda) -->
        <a-entity id="gallery-panel-historia" class="clickable gallery-panel" cursor-hover data-id="historia"
            position="0 1.6 -2" rotation="0 142 0">
            <a-curvedimage src="#panel-historia-img" height="1.2" radius="4.8" theta-length="35"
                opacity="0.95"></a-curvedimage>
        </a-entity>
        <a-entity position="0 2.5 -2.16" rotation="0 -20 0" id="CurvedHistoria"
            curved-text="value: HISTORIA; radius: 4.75; arc: 30; ; fontSize: 0.25"></a-entity>

        <!-- Tecnologia (centro-esquerda) -->
        <a-entity id="gallery-panel-tecnologia" class="clickable gallery-panel" data-id="tecnologia" position="0 1.6 -2"
            rotation="0 98 0" cursor-hover>
            <a-curvedimage src="#panel-tecnologia-img" height="1.2" radius="4.8" theta-length="35"
                opacity="0.95"></a-curvedimage>
        </a-entity>
        <a-entity position="0 2.5 -2.36" rotation="0 -67 0" id="CurvedTecnologia"
            curved-text="value: TECNOLOGIA; radius: 4.75; arc: 30; ; fontSize: 0.25"></a-entity>

        <!-- Missões (centro-direita) -->
        <a-entity id="gallery-panel-missoes" class="clickable gallery-panel" data-id="missoes" position="0 1.6 -2"
            rotation="0 44 0" cursor-hover>
            <a-curvedimage src="#panel-missoes-img" height="1.2" radius="4.8" theta-length="35"
                opacity="0.95"></a-curvedimage>
        </a-entity>
        <a-entity position="0 2.5 -1.66" rotation="0 -114 0" id="CurvedMissoes"
            curved-text="value: MISSOES; radius: 4.75; arc: 30; ; fontSize: 0.25"></a-entity>

        <!-- Futuro (direita) -->
        <a-entity id="gallery-panel-futuro" class="clickable gallery-panel" data-id="futuro" position="0 1.6 -2"
            rotation="0 1.37 0" cursor-hover>
            <a-curvedimage src="#panel-futuro-img" height="1.2" radius="4.8" theta-length="35"
                opacity="0.95"></a-curvedimage>
        </a-entity>
        <a-entity position="0 2.5 -1.79" rotation="0 -160 0" id="CurvedFuturo"
            curved-text="value: FUTURO; radius: 4.75; arc: 30; ; fontSize: 0.25"></a-entity>

        <a-entity position="-2.9 1.8 -5.5" rotation="0 -145 0" id="portal" scale="0.8 0.8 0.8">

            <!-- Anéis orbitantes ao redor do portal - Buraco Negro -->
            <!-- Anel externo - disco de acreção -->
            <a-torus color="#E0E0E0" radius="1.3" radius-tubular="0.02"
                material="emissive: #FFFFFF; emissiveIntensity: 0.4; opacity: 0.6; transparent: true"
                animation="property: rotation; to: 0 0 360; loop: true; dur: 4000; easing: linear">
            </a-torus>

            <!-- Anel interno escuro -->
            <a-torus color="#424242" radius="1.1" radius-tubular="0.015"
                material="emissive: #616161; emissiveIntensity: 0.3; opacity: 0.7; transparent: true"
                animation="property: rotation; to: 0 0 -360; loop: true; dur: 3000; easing: linear">
            </a-torus>

            <!-- Partículas/esferas pequenas orbitando -->
            <a-entity rotation="0 0 0"
                animation="property: rotation; to: 0 0 360; loop: true; dur: 5000; easing: linear">
                <a-sphere color="#E0E0E0" radius="0.035" position="1.2 0 0"
                    material="emissive: #FFFFFF; emissiveIntensity: 0.6; opacity: 0.8; transparent: true"></a-sphere>
                <a-sphere color="#9E9E9E" radius="0.035" position="-1.2 0 0"
                    material="emissive: #BDBDBD; emissiveIntensity: 0.5; opacity: 0.8; transparent: true"></a-sphere>
            </a-entity>

            <!-- Brilho/glow principal ao redor do portal -->
            <a-ring color="#E0E0E0" radius-inner="0.98" radius-outer="1.05"
                material="emissive: #FFFFFF; emissiveIntensity: 0.4; opacity: 0.3; transparent: true; side: double"
                animation="property: material.emissiveIntensity; from: 0.3; to: 0.7; loop: true; dur: 1500; dir: alternate; easing: easeInOutSine">
            </a-ring>

            <!-- Luz pontual do portal -->
            <a-light type="point" intensity="1" color="#E0E0E0" distance="3" position="0 0 0.2"
                animation="property: intensity; from: 0.8; to: 1.5; loop: true; dur: 1500; dir: alternate; easing: easeInOutSine">
            </a-light>

            <a-circle radius="1" class="clickable" segments="64" vr-link="href: scene01.html"
                material="shader: portal; pano: #360scene01; side: double" cursor-hover>
            </a-circle>

            <!-- Placa de informação estilizada -->
            <a-entity position="-0.0142 -1.36684 -0.21126" rotation="0 180 0">
                <a-plane color="#1a1a1a" width="2.3" height="0.4"
                    material="opacity: 0.9; emissive: #2a2a2a; emissiveIntensity: 0.392"
                    animation="property: material.emissiveIntensity; from: 0.2; to: 0.4; loop: true; dur: 2000; dir: alternate; easing: easeInOutSine"
                    geometry="">
                </a-plane>

                <a-text value="Voltar para sala 01" align="center" position="0 0 0.01" width="3" color="#FFFFFF"
                    font="roboto"></a-text>

            </a-entity>

        </a-entity>


    </a-scene>


    <script>
        // Mapeamento de modelos para assets
        const modelAssets = {
            'hubble': '#hubble-asset',
            'voyager': '#voyager-asset',

            'jwst': '#jwst-asset',
            'saturnv': '#saturnv-asset',
            'iss': '#iss-asset'
        };

        // Variáveis globais para navegação
        let currentModelType = 'hubble';
        let currentConfig = {};
        let modelsConfig = {};

        // Carrega configurações do JSON
        fetch('modelsConfig.json')
            .then(r => r.json())
            .then(config => {
                modelsConfig = config;
            })
            .catch(err => console.error('Erro ao carregar modelsConfig.json:', err));

        // Função global para esconder painel 3D
        function hideInfoPanel3D() {
            const container = document.querySelector('#infoPanelContainer3D');
            if (container) {
                container.innerHTML = '';
                const hotspotIcon = document.querySelector('#hotspot-3d-icon');
                if (hotspotIcon) hotspotIcon.setAttribute('visible', true);
            }
        }

        // Função global para abrir painel 3D
        function openPanel3D(event) {
            const template = document.querySelector('#infoPanel3D');
            const container = document.querySelector('#infoPanelContainer3D');

            if (!container || !template) {
                console.log('Container ou template não encontrado');
                return;
            }

            hideInfoPanel3D();

            const clone = document.importNode(template.content, true);
            container.appendChild(clone);

            const hotspotIcon = document.querySelector('#hotspot-3d-icon');
            if (hotspotIcon) hotspotIcon.setAttribute('visible', false);

            setTimeout(() => {
                const closeBtn = container.querySelector('#close-btn-3d');
                if (closeBtn) {
                    closeBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        hideInfoPanel3D();
                    });
                }

                const viewBtn = container.querySelector('#view-3d-btn');
                if (viewBtn) {
                    viewBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        navegarParaCena3();
                    });
                }
            }, 100);
        }

        // Recupera o modelo selecionado e renderiza
        window.addEventListener('load', () => {
            const modelType = sessionStorage.getItem('modeloExibicao') || 'hubble';
            currentModelType = modelType;

            // Configura hotspot 3D
            const hotspot3D = document.querySelector('[data-triggerable-button="3d"]');
            if (hotspot3D) {
                let fuseTimeout = null;

                hotspot3D.addEventListener('click', (e) => {
                    console.log('Hotspot 3D clicado');
                    if (fuseTimeout) {
                        clearTimeout(fuseTimeout);
                        fuseTimeout = null;
                    }
                    openPanel3D(e);
                });

                hotspot3D.addEventListener('fusing', (e) => {
                    if (fuseTimeout) clearTimeout(fuseTimeout);
                    fuseTimeout = setTimeout(() => openPanel3D(e), 2000);
                });

                hotspot3D.addEventListener('mouseleave', () => {
                    if (fuseTimeout) {
                        clearTimeout(fuseTimeout);
                        fuseTimeout = null;
                    }
                });
            }

            // Aguarda o JSON carregar antes de aplicar configs
            const checkConfig = setInterval(() => {
                if (Object.keys(modelsConfig).length > 0) {
                    clearInterval(checkConfig);

                    // Busca config do JSON
                    if (modelsConfig[modelType] && modelsConfig[modelType]['scene02']) {
                        currentConfig = modelsConfig[modelType]['scene02'];
                    } else {
                        currentConfig = { position: '-4 0.7 -2', scale: '0.005 0.005 0.005', rotation: '0 0 0' };
                    }

                    const dynamicModel = document.getElementById('dynamic-model-pedestal');

                    // Map de modelos para IDs dos assets
                    const modelMap = {
                        'hubble': 'hubble-asset',
                        'voyager': 'voyager-asset',
                        'jwst': 'jwst-asset',
                        'saturnv': 'saturnv-asset',
                        'iss': 'iss-asset'
                    };

                    const assetId = modelMap[modelType];
                    if (assetId) {
                        dynamicModel.setAttribute('gltf-model', `#${assetId}`);
                        dynamicModel.setAttribute('position', currentConfig.position);
                        dynamicModel.setAttribute('scale', currentConfig.scale);
                        dynamicModel.setAttribute('rotation', currentConfig.rotation);
                    }

                    // Atualiza título da galeria
                    const titles = {
                        'hubble': 'TELESCOPIO HUBBLE',
                        'voyager': 'SONDA VOYAGER 1',
                        'jwst': 'JAMES WEBB SPACE TELESCOPE',
                        'saturnv': 'FOGUETE SATURN V',
                        'iss': 'ESTACAO ESPACIAL INTERNACIONAL'
                    };

                    document.getElementById('gallery-main-title').setAttribute('value', titles[modelType] || 'MUSEU ESPACIAL');

                    // Adicionar evento de clique no modelo para abrir o painel 3D
                    if (dynamicModel) {
                        console.log('Adicionando evento de clique ao modelo');

                        dynamicModel.addEventListener('click', (e) => {
                            console.log('Modelo 3D clicado!');
                            e.stopPropagation();
                            openPanel3D(e);
                        });

                        // Adicionar suporte a fusing no modelo
                        let modelFuseTimeout = null;

                        dynamicModel.addEventListener('fusing', (e) => {
                            console.log('Modelo fusing');
                            if (modelFuseTimeout) clearTimeout(modelFuseTimeout);
                            modelFuseTimeout = setTimeout(() => openPanel3D(e), 2000);
                        });

                        dynamicModel.addEventListener('mouseleave', () => {
                            if (modelFuseTimeout) {
                                clearTimeout(modelFuseTimeout);
                                modelFuseTimeout = null;
                            }
                        });

                        dynamicModel.classList.add('clickable');
                    }
                }
            }, 100);
        });

        // Função para navegar para a cena 3D
        function navegarParaCena3() {
            sessionStorage.setItem('modeloExibicao', currentModelType);

            // Ativa animação do wormhole
            const wormhole = document.querySelector('#wormhole-tunnel');
            if (wormhole) {
                wormhole.setAttribute('wormhole-transition', 'active', true);
            }

            setTimeout(() => {
                document.body.style.opacity = '0';
            }, 1500);

            setTimeout(() => {
                window.location.href = 'scene03.html';
            }, 2500);
        }

        // Sistema de Diálogos Expansíveis
        const dialogContent = {
            historia: {
                hubble: {
                    title: 'História do Telescópio Hubble',
                    text: 'Lançado em 1990 pela NASA e ESA, o Telescópio Espacial Hubble revolucionou nossa compreensão do universo. Nomeado em homenagem ao astrônomo Edwin Hubble, este observatório orbital tem fornecido imagens incríveis do cosmos por mais de três décadas, revelando galáxias distantes, nebulosas coloridas e ajudando a determinar a idade do universo.'
                },
                voyager: {
                    title: 'História da Voyager 1',
                    text: 'Lançada em 5 de setembro de 1977, a Voyager 1 é uma das missões mais bem-sucedidas da NASA. Projetada para estudar Júpiter e Saturno, superou todas as expectativas ao se tornar o primeiro objeto feito pelo homem a entrar no espaço interestelar em 2012. Carrega o famoso Disco de Ouro com sons e imagens da Terra.'
                },
                jwst: {
                    title: 'História do James Webb',
                    text: 'O Telescópio Espacial James Webb foi lançado em 25 de dezembro de 2021, após décadas de desenvolvimento. Sucessor espiritual do Hubble, o JWST observa principalmente no infravermelho, permitindo ver através de poeira cósmica e observar as primeiras galáxias formadas após o Big Bang.'
                },
                saturnv: {
                    title: 'História do Saturn V',
                    text: 'O Saturn V foi o foguete mais poderoso já construído quando entrou em operação em 1967. Desenvolvido pela NASA sob a direção de Wernher von Braun, foi crucial para o programa Apollo, levando astronautas à Lua entre 1969 e 1972. Com 110 metros de altura, permanece como símbolo da era espacial.'
                },
                iss: {
                    title: 'História da Estação Espacial Internacional',
                    text: 'A construção da ISS começou em 1998 como projeto cooperativo entre NASA, Roscosmos, ESA, JAXA e CSA. É o maior objeto já construído no espaço e tem abrigado continuamente humanos desde novembro de 2000, servindo como laboratório de microgravidade e observatório astronômico.'
                }
            },
            tecnologia: {
                hubble: {
                    title: 'Tecnologia do Hubble',
                    text: 'O Hubble possui um espelho primário de 2.4 metros e instrumentos científicos avançados como câmeras CCD, espectrógrafos e sensores infravermelhos. Orbita a 547 km de altitude, completando uma volta na Terra a cada 95 minutos. Suas missões de manutenção por ônibus espaciais permitiram atualizações tecnológicas constantes.'
                },
                voyager: {
                    title: 'Tecnologia da Voyager',
                    text: 'A Voyager 1 é alimentada por três geradores termoelétricos de radioisótopos (RTGs) que convertem calor de plutônio-238 em eletricidade. Possui antena parabólica de 3.7 metros para comunicação com a Terra. Seus instrumentos incluem câmeras, espectrômetros e detectores de partículas carregadas.'
                },
                jwst: {
                    title: 'Tecnologia do James Webb',
                    text: 'O JWST possui um espelho primário segmentado de 6.5 metros coberto com ouro, otimizado para observações infravermelhas. Seu protetor solar do tamanho de uma quadra de tênis mantém os instrumentos a -233°C. Posicionado no ponto Lagrange L2, a 1.5 milhão de km da Terra.'
                },
                saturnv: {
                    title: 'Tecnologia do Saturn V',
                    text: 'O Saturn V tinha três estágios: S-IC com cinco motores F-1 queimando querosene e oxigênio líquido, S-II com cinco motores J-2 usando hidrogênio e oxigênio líquidos, e S-IVB com um motor J-2. Podia lançar até 140 toneladas para órbita baixa da Terra ou 48 toneladas para a Lua.'
                },
                iss: {
                    title: 'Tecnologia da ISS',
                    text: 'A ISS tem painéis solares que geram 120 kW de energia, módulos pressurizados para habitação e pesquisa, braços robóticos para manipulação externa e sistemas de suporte à vida que reciclam água e ar. Viaja a 28.000 km/h a 400 km de altitude, orbitando a Terra 16 vezes por dia.'
                }
            },
            missoes: {
                hubble: {
                    title: 'Missões do Hubble',
                    text: 'O Hubble realizou observações cruciais incluindo: medição precisa da expansão do universo, descoberta de energia escura, imagens profundas revelando milhares de galáxias, estudos de buracos negros supermassivos, análise de atmosferas de exoplanetas e captura de imagens icônicas como os Pilares da Criação.'
                },
                voyager: {
                    title: 'Missões da Voyager',
                    text: 'A Voyager 1 sobrevoou Júpiter em 1979, descobrindo anéis e luas vulcânicas, depois Saturno em 1980. Continuou sua jornada para o espaço interestelar, enviando dados sobre o meio interestelar. Ainda transmite informações a mais de 24 bilhões de km da Terra.'
                },
                jwst: {
                    title: 'Missões do James Webb',
                    text: 'O JWST está observando as primeiras galáxias formadas após o Big Bang, estudando a formação estelar e planetária, analisando atmosferas de exoplanetas em busca de sinais de habitabilidade, e produzindo imagens infravermelhas profundas nunca antes vistas.'
                },
                saturnv: {
                    title: 'Missões do Saturn V',
                    text: 'O Saturn V foi usado em 13 lançamentos, incluindo Apollo 8 (primeira missão tripulada à órbita lunar), Apollo 11 (primeiro pouso lunar), e todas as missões Apollo subsequentes. Também lançou a estação espacial Skylab em 1973.'
                },
                iss: {
                    title: 'Missões da ISS',
                    text: 'A ISS serve como plataforma para pesquisas em biologia, física, astronomia e meteorologia. Experimentos incluem crescimento de cristais, comportamento de fluidos em microgravidade, efeitos de longo prazo do espaço no corpo humano e testes de tecnologias para missões futuras.'
                }
            },
            futuro: {
                hubble: {
                    title: 'Futuro do Hubble',
                    text: 'O Hubble continua operacional, mas sua órbita gradualmente decai. Sem missões de manutenção planejadas, espera-se que funcione até meados dos anos 2030. Seu legado continuará através do James Webb e futuros telescópios espaciais que ele inspirou.'
                },
                voyager: {
                    title: 'Futuro da Voyager',
                    text: 'A Voyager 1 continuará enviando dados enquanto sua energia durar, provavelmente até 2025-2030. Depois, seguirá em silêncio pelo espaço interestelar. Em cerca de 40.000 anos, passará a 1.6 anos-luz da estrela Gliese 445.'
                },
                jwst: {
                    title: 'Futuro do James Webb',
                    text: 'O JWST tem combustível para operar por mais de 20 anos. Continuará revolucionando nossa compreensão do universo primitivo, sistemas planetários e a busca por vida extraterrestre. Seus dados serão estudados por décadas.'
                },
                saturnv: {
                    title: 'Futuro do Saturn V',
                    text: 'Embora aposentado em 1973, o Saturn V inspirou o desenvolvimento do SLS (Space Launch System) da NASA. Suas tecnologias e lições de engenharia continuam influenciando o design de foguetes pesados modernos para exploração espacial profunda.'
                },
                iss: {
                    title: 'Futuro da ISS',
                    text: 'A ISS está planejada para operar até pelo menos 2030. Após isso, será desorbitalizada de forma controlada. Estações futuras incluem projetos comerciais como Axiom Station e Gateway lunar, que aplicarão conhecimentos adquiridos na ISS.'
                }
            }
        };

        const overlay = document.getElementById('dialog-overlay');
        const dialogTitle = document.getElementById('dialog-title');
        const dialogText = document.getElementById('dialog-text');
        const closeBtn = document.getElementById('close-dialog');

        // LÓGICA DO HOTSPOT 3D
        function hideInfoPanel3D() {
            const container = document.querySelector('#infoPanelContainer3D');
            if (container) {
                container.innerHTML = '';
                const hotspotIcon = document.querySelector('#hotspot-3d-icon');
                if (hotspotIcon) hotspotIcon.setAttribute('visible', true);
            }
        }

        // Configura hotspot 3D
        const hotspot3D = document.querySelector('[data-triggerable-button="3d"]');
        if (hotspot3D) {
            let fuseTimeout = null;

            const openPanel3D = function (event) {
                if (fuseTimeout) {
                    clearTimeout(fuseTimeout);
                    fuseTimeout = null;
                }

                const template = document.querySelector('#infoPanel3D');
                const container = document.querySelector('#infoPanelContainer3D');

                if (!container || !template) return;

                hideInfoPanel3D();

                const clone = document.importNode(template.content, true);
                container.appendChild(clone);

                const hotspotIcon = document.querySelector('#hotspot-3d-icon');
                if (hotspotIcon) hotspotIcon.setAttribute('visible', false);

                setTimeout(() => {
                    const closeBtn = container.querySelector('#close-btn-3d');
                    if (closeBtn) {
                        closeBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            hideInfoPanel3D();
                        });
                    }

                    const viewBtn = container.querySelector('#view-3d-btn');
                    if (viewBtn) {
                        viewBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            navegarParaCena3();
                        });
                    }
                }, 100);
            };

            hotspot3D.addEventListener('click', openPanel3D);

            hotspot3D.addEventListener('fusing', (e) => {
                if (fuseTimeout) clearTimeout(fuseTimeout);
                fuseTimeout = setTimeout(() => openPanel3D(e), 2000);
            });

            hotspot3D.addEventListener('mouseleave', () => {
                if (fuseTimeout) {
                    clearTimeout(fuseTimeout);
                    fuseTimeout = null;
                }
            });
        }

        // Adicionar eventos de clique nos painéis
        document.querySelectorAll('.gallery-panel').forEach(panel => {
            panel.addEventListener('click', () => {
                const panelId = panel.getAttribute('data-id');
                const modelType = sessionStorage.getItem('modeloExibicao') || 'hubble';

                if (dialogContent[panelId] && dialogContent[panelId][modelType]) {
                    const content = dialogContent[panelId][modelType];
                    dialogTitle.textContent = content.title;
                    dialogText.textContent = content.text;
                    overlay.style.display = 'flex';
                }
            });
        });

        // Fechar diálogo
        closeBtn.addEventListener('click', () => {
            overlay.style.display = 'none';
        });

        // Fechar ao clicar fora do conteúdo
        overlay.addEventListener('click', (e) => {
            if (e.target === overlay) {
                overlay.style.display = 'none';
            }
        });
        AFRAME.registerComponent('mobile-look-controls', {
            schema: {
                sensitivity: { default: 0.3 }
            },

            init: function () {
                // Desabilita pointer lock no desktop
                const isMobile = AFRAME.utils.device.isMobile();

                // Configura look-controls baseado no dispositivo
                const lookControls = this.el.components['look-controls'];
                if (lookControls) {
                    if (isMobile) {
                        // Mobile: desabilita look-controls padrão
                        lookControls.pause();
                    } else {
                        // Desktop: configura look-controls sem pointer lock
                        this.el.setAttribute('look-controls', {
                            pointerLockEnabled: false,
                            reverseMouseDrag: false,
                            touchEnabled: false
                        });
                        return; // Não inicializa controles mobile
                    }
                }

                // Resto do código só executa no mobile
                this.onTouchStart = this.onTouchStart.bind(this);
                this.onTouchMove = this.onTouchMove.bind(this);
                this.onTouchEnd = this.onTouchEnd.bind(this);

                this.touchStartX = 0;
                this.touchStartY = 0;
                this.isTouch = false;

                this.el.sceneEl.addEventListener('enter-vr', () => {
                    if (lookControls) lookControls.pause();
                });

                window.addEventListener('touchstart', this.onTouchStart, { passive: false });
                window.addEventListener('touchmove', this.onTouchMove, { passive: false });
                window.addEventListener('touchend', this.onTouchEnd, { passive: false });
            },

            onTouchStart: function (evt) {
                if (evt.target.id === 'np' ||
                    evt.target.closest('#np') ||
                    (evt.target.classList && evt.target.classList.contains('clickable'))) {
                    return;
                }

                this.isTouch = true;
                this.touchStartX = evt.touches[0].clientX;
                this.touchStartY = evt.touches[0].clientY;
            },

            onTouchMove: function (evt) {
                if (!this.isTouch) return;

                evt.preventDefault();

                const deltaX = evt.touches[0].clientX - this.touchStartX;
                const deltaY = evt.touches[0].clientY - this.touchStartY;

                const rotation = this.el.getAttribute('rotation');

                rotation.y -= deltaX * this.data.sensitivity;
                rotation.x -= deltaY * this.data.sensitivity;
                rotation.x = Math.max(-85, Math.min(85, rotation.x));

                this.el.setAttribute('rotation', rotation);

                this.touchStartX = evt.touches[0].clientX;
                this.touchStartY = evt.touches[0].clientY;
            },

            onTouchEnd: function (evt) {
                this.isTouch = false;
            },

            remove: function () {
                if (AFRAME.utils.device.isMobile()) {
                    window.removeEventListener('touchstart', this.onTouchStart);
                    window.removeEventListener('touchmove', this.onTouchMove);
                    window.removeEventListener('touchend', this.onTouchEnd);
                }
            }
        });

    </script>






</body>

</html>